# 開発・運用計画

近畿大学体育会ボクシング部 公式ウェブサイトの開発および公開手順のまとめです。

## 1. サイト構築とコンテンツ整備 (現状)
まずは公開できる状態までサイトの中身を作り込みます。

- [x] フロントエンドの実装
    - [x] 基本的なページ構成、デザインの実装 (完了)
- [ ] テキストの修正
    - [ ] AIが作成した仮の文章を削除し、適切な日本語の文章に差し替える。
- [x] 画像保存先のR2移行 (先行実施)
    - [x] Cloudflare R2バケットの作成。
    - [x] 画像データをR2にアップロード (personフォルダ)。
    - [x] `next.config.ts` でR2ドメイン (`*.r2.dev`) からの画像を許可する設定を追加。
    - [x] `lib/utils/path.ts` を修正し、画像をR2から配信するように変更。
- [ ] チームデータベースの完成
    - [ ] 部員名簿 (`members.csv`) を正確な情報に更新する。
    - [ ] コーチ名簿 (`coaches.csv`) を正確な情報に更新する。
    - [ ] 顔写真データを集める。
    - [ ] 画像ファイルの軽量化(WebP変換)と命名規則の統一を行う。
    - [ ] R2に顔写真をアップロードする。
- [/] コードベースの健全化 (Technical)
    - [ ] 未使用なコンポーネントや画像の削除 (クリーンアップ)。
    - [ ] `npm run build` および `npm run lint` がエラーなく通ることを確認する。
        - [ ] ESLint設定 (`eslint.config.mjs`) の修正。 (現在ビルドエラー発生中)

## 2. サーバー移行と本番公開
GitHub PagesからNext.jsに適した環境へ移行し、独自のドメインで公開します。

- [x] Cloudflare Pagesへの移行 (もともとvercelのつもり)
    - [x] GitHubリポジトリをCloudflare Pagesに連携し、デプロイ環境を構築する。 (完了)
    - [x] `next.config.ts` の設定調整。
- [ ] 独自ドメインの設定
    - [ ] Cloudflare Pagesでカスタムドメインを追加する。
    - [ ] Xserver側でDNS設定を変更し、新サイトが表示されるようにする。
    - [ ] R2バケットにカスタムドメインを接続する (本番運用のためのレート制限回避)。
- [ ] SEO対策 (Search Engine Optimization)
    - [ ] メタデータ設定: 各ページの `title` と `description` を正しく設定する。
    - [ ] OGP設定: SNSでシェアされた際に表示される画像やタイトルを設定する。
    - [ ] `robots.txt` と `sitemap.xml` の作成: 検索エンジンにサイト構造を伝える。
    - [ ] ファビコン (favicon) とWebクリップアイコンの設定。
    - [ ] 404ページ (Not Found) の作成。

## 3. CMS導入とCloudflare移行計画
監督（非エンジニア）が自ら「名簿更新」や「ニュース発信」を行えるようにシステム化し、Cloudflare上の安価で高速な環境へ完全移行します。

### 3-1. 要件定義 (Requirements)
*   利用者: 監督および指名された部員（非技術者）。
*   必須機能:
    1.  部員名簿管理: 名前、役職、顔写真の追加・編集・削除がGUI（管理画面）からできること。
    2.  ニュース/ブログ管理: 試合結果や連絡事項を投稿できること。
    3.  画像管理: アップロードした写真が自動的に保存・公開されること。
*   採用技術:
    *   機能が統合されており、コストパフォーマンスに優れる Cloudflare D1 (DB) と R2 (Storage) を採用します。

### 3-2. 基本設計 (Basic Design)
-   インフラ構成:
    -   Hosting: Cloudflare Pages
    -   Database: Cloudflare D1 (SQLite) - メンバー情報、ニュース記事の保存。
    -   Storage: Cloudflare R2 - 顔写真、記事画像の保存 (Phase 1で導入済み)。
-   データモデル案:
    -   `members`: ID(学籍番号), 名前, 役職, 学年, 画像URL
    -   `news`: ID, タイトル, 本文, 公開日, 画像URL
-   アプリケーション構成:
    -   `/admin`: 認証付きの管理画面。データの書き込み・更新を行う。
    -   `/ (Public)`: 閲覧専用。D1/R2からデータを取得して表示する（ISR/SSRまたはクライアントサイド取得）。

### 3-3. 実装・移行タスク
- [x] 環境構築
    - [x] Cloudflareプロジェクトの作成、D1データベースとR2ストレージの作成・紐付け。
- [ ] 管理機能の開発 (CMS)
    - [ ] 画像アップローダー: R2へ画像を保存し、URLを取得する機能。
    - [ ] 名簿編集機能: D1上のメンバーデータを追加・更新・削除する画面。
    - [ ] ニュース投稿機能: タイトルと本文を入力し、記事として保存する画面。
- [x] フロントエンド改修 (Cloudflare D1対応)
    - [x] Cloudflare D1データベースのスキーマ定義 (`wrangler.json`)。
    - [x] Next.js API Route (`app/api/members/route.ts`) の実装。`getRequestContext` を使用してD1バインディングにアクセス。
    - [x] `fetchMembers` をCSV読み込みからAPI経由に変更。
    - [x] Cloudflare Pagesデプロイ環境の修正。
        - [x] `@cloudflare/next-on-pages` の導入。
        - [x] ビルドエラー対応: Next.js v16 (Turbopack) との非互換性のため、Next.js v15.0.3 へダウングレード。
        - [x] `wrangler.json` へのD1 ID設定。
- [ ] 本番移行
    - [x] Cloudflare Pagesへデプロイ (デプロイ環境構築完了)。
    - [ ] Cloudflare Pages管理画面でのD1バインディング設定 (手動)。
    - [ ] DNS設定を切り替え、完全移行。
